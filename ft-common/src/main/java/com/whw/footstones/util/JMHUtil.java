package com.whw.footstones.util;import lombok.extern.slf4j.Slf4j;import org.openjdk.jmh.annotations.*;import org.openjdk.jmh.infra.Blackhole;import org.openjdk.jmh.results.format.ResultFormatType;import org.openjdk.jmh.runner.Runner;import org.openjdk.jmh.runner.RunnerException;import org.openjdk.jmh.runner.options.Options;import org.openjdk.jmh.runner.options.OptionsBuilder;import java.util.concurrent.TimeUnit;/** * @author chenlinya * @version 1.0 * @description: TODO * @date 2021/11/1 7:50 PM */@BenchmarkMode(Mode.AverageTime)//使用模式为执行时间 默认吞吐量@Warmup(iterations = 3, time = 1) //预热次数，默认每次运行一秒，运行10次@Measurement(iterations = 5, time = 1, timeUnit = TimeUnit.SECONDS)@Threads(4)//并发线程数@Fork(1)@State(value = Scope.Benchmark)//对象的生命周期@OutputTimeUnit(TimeUnit.NANOSECONDS)//统计结果的时间单元@Slf4jpublic class JMHUtil {    @Param(value = {"10", "50", "100"})    private int length;//    @Benchmark//    public void measureName() {//        log.error("eee");//        System.out.println("test");//    }    @Benchmark    public void testStringAdd(Blackhole blackhole) {        String a = "";        for (int i = 0; i < length; i++) {            a += i;        }        blackhole.consume(a);    }    @Benchmark    public void testStringBuilderAdd(Blackhole blackhole) {        StringBuilder sb = new StringBuilder();        for (int i = 0; i < length; i++) {            sb.append(i);        }        blackhole.consume(sb.toString());    }    public static void main(String[] args) throws RunnerException {        Options opt = new OptionsBuilder()                .include(JMHUtil.class.getSimpleName()).forks(1)                .result("result.json")                .resultFormat(ResultFormatType.JSON).build();        new Runner(opt).run();    }}